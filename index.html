<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KY Teacher Supply & Demand Dashboard</title>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- PapaParse for CSV parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
    .container { max-width: 1200px; margin: auto; padding: 20px; display: grid; gap: 20px; }
    .filters { display: flex; gap: 10px; flex-wrap: wrap; }
    .filters select, .filters input { padding: 5px; border-radius: 4px; border: 1px solid #ccc; }
    .kpi-cards { display: flex; gap: 20px; justify-content: space-between; }
    .card { background: #fff; flex: 1; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; }
    .card h2 { margin: 0; font-size: 2rem; }
    .card p { margin: 0; color: #666; }
    .charts-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
    /* Adjust grid for larger screens to accommodate the new layout */
    @media (min-width: 800px) {
      .charts-grid {
        grid-template-columns: 1fr 1fr; /* Default for two columns */
      }
      /* Specific styling for the chart items for the new layout */
      .charts-grid > .chart:nth-child(1) { /* Supply vs Demand */
        grid-column: 1 / -1; /* Span full width */
      }
      .charts-grid > .chart:nth-child(2) { /* Institution Output */
        /* Will naturally flow into the first column of the next row */
      }
      .charts-grid > .chart:nth-child(3) { /* Retirement Projection */
        /* Will naturally flow into the second column of the next row */
      }
    }
    .chart, .table-container, .map-container { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .table-container table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .table-container th, .table-container td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    .map-container { text-align: center; }
    .map-container object { width: 100%; height: auto; }
    .note { font-size: 0.9rem; color: #555; margin-top: -10px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Filters -->
    <div class="filters">
      <select id="yearRange"><option value="0-5">Now - 5 yrs</option><option value="0-10">Now - 10 yrs</option></select>
      <select id="subjectArea"><option value="all">All Subjects</option><option value="elementary">Elementary</option><option value="math">Math</option></select>
      <select id="institutionType"><option value="all">All Institutions</option><option value="public">Public</option><option value="private">Private</option></select>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-cards">
      <div class="card"><h2 id="totalOpen">--</h2><p>Total Open Positions</p></div>
      <div class="card"><h2 id="newCerts">--</h2><p>New Certified Teachers</p></div>
      <div class="card"><h2 id="projRetire">--</h2><p>Projected Retirements</p></div>
    </div>

    <!-- Charts -->
    <div class="charts-grid">
      <div class="chart"><h3>Supply vs Demand by Specialty</h3><canvas id="supplyDemandChart"></canvas></div>
      <div class="chart"><h3>Institution Output (Top 10)</h3><canvas id="institutionChart"></canvas></div>
      <div class="chart"><h3>Retirement Projection</h3><canvas id="retireChart"></canvas></div>
    </div>

    <!-- County Map -->
    <div class="map-container">
      <h3>Vacancies by County</h3>
      <p class="note">(Requires HTTP server to load SVG via relative path)</p>
      <!-- Ensure ky_counties.svg is in same folder or adjust path -->
      <object type="image/svg+xml" data="assets/ky_counties.svg"></object>
    </div>

    <!-- CIP Positions Table -->
    <div class="table-container">
      <h3>CIP Code Positions Reference</h3>
      <p class="note">(Ensure cips_positions.csv is in same folder)</p>
      <table id="positionsTable">
        <thead><tr><th>CIP Code</th><th>Position Title</th></tr></thead>
        <tbody><tr><td colspan="2">Loading...</td></tr></tbody>
      </table>
    </div>
  </div>

  <script>
    // Example KPI values
    document.getElementById('totalOpen').innerText = '4,120';
    document.getElementById('newCerts').innerText = '2,350';
    document.getElementById('projRetire').innerText = '3,800';

    // Supply vs Demand Chart
    Papa.parse('data/supply_demand_specialty.csv', {
      download: true, header: true, skipEmptyLines: true,
      complete: function(results) {
        const specialties = [];
        const openings = [];
        const certs = [];
        results.data.forEach(row => {
          specialties.push(row.Specialty);
          openings.push(parseInt(row.Openings));
          certs.push(parseInt(row.NewCerts));
        });
        new Chart('supplyDemandChart', {
          type: 'bar',
          data: {
            labels: specialties,
            datasets: [
              { label: 'Openings', data: openings, backgroundColor: 'rgba(255, 99, 132, 0.5)' },
              { label: 'New Certs', data: certs, backgroundColor: 'rgba(54, 162, 235, 0.5)' }
            ]
          },
          options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
        });
      }
    });

    // Institution Output Chart
    Papa.parse('data/institution_output.csv', {
      download: true, header: true, skipEmptyLines: true,
      complete: function(results) {
        const institutions = [];
        const grads = [];
        results.data.forEach(row => {
          institutions.push(row.Institution);
          grads.push(parseInt(row.Graduates));
        });
        new Chart('institutionChart', {
          type: 'bar',
          data: {
            labels: institutions,
            datasets: [{ label: 'Graduates', data: grads, backgroundColor: 'rgba(75, 192, 192, 0.5)' }]
          },
          options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, scales: { x: { beginAtZero: true } } }
        });
      }
    });

    // Retirement Projection Chart
    Papa.parse('data/retirement_projection.csv', {
      download: true, header: true, skipEmptyLines: true,
      complete: function(results) {
        const years = [];
        const retire55_59 = [];
        const retire60_64 = [];
        results.data.forEach(row => {
          years.push(row.Year);
          retire55_59.push(parseInt(row.RetirementsAge55_59));
          retire60_64.push(parseInt(row.RetirementsAge60_64));
        });
        new Chart('retireChart', {
          type: 'line',
          data: {
            labels: years,
            datasets: [
              { label: 'Age 55-59', data: retire55_59, borderColor: 'rgba(255, 159, 64, 1)', fill: false },
              { label: 'Age 60-64', data: retire60_64, borderColor: 'rgba(153, 102, 255, 1)', fill: false }
            ]
          },
          options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
        });
      }
    });

    // Load CIP positions CSV
    Papa.parse('data/cips_positions.csv', {
      download: true, header: true,
      complete: results => {
        const tbody = document.querySelector('#positionsTable tbody');
        tbody.innerHTML = '';
        results.data.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${row['CIP Code']}</td><td>${row['Title']}</td>`;
          tbody.appendChild(tr);
        });
      }
    });
  </script>
</body>
</html>
