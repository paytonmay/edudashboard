<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KY Teacher Supply & Demand Dashboard</title>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- PapaParse for CSV parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
    .container { max-width: 1200px; margin: auto; padding: 20px; display: grid; gap: 20px; }
    .filters { display: flex; gap: 10px; flex-wrap: wrap; }
    .filters select, .filters input { padding: 5px; border-radius: 4px; border: 1px solid #ccc; }
    .kpi-cards { display: flex; gap: 20px; justify-content: space-between; }
    .card { background: #fff; flex: 1; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; }
    .card h2 { margin: 0; font-size: 2rem; }
    .card p { margin: 0; color: #666; }
    .charts-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
    @media (min-width: 800px) { .charts-grid { grid-template-columns: 1fr 1fr; } }
    .chart, .table-container, .map-container { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .table-container table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .table-container th, .table-container td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    .map-container { text-align: center; }
    .map-container object { width: 100%; height: auto; }
    .note { font-size: 0.9rem; color: #555; margin-top: -10px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Filters -->
    <div class="filters">
      <select id="yearRange"><option value="0-5">Now - 5 yrs</option><option value="0-10">Now - 10 yrs</option></select>
      <select id="subjectArea"><option value="all">All Subjects</option><option value="elementary">Elementary</option><option value="math">Math</option></select>
      <select id="institutionType"><option value="all">All Institutions</option><option value="public">Public</option><option value="private">Private</option></select>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-cards">
      <div class="card"><h2 id="totalOpen">--</h2><p>Total Open Positions</p></div>
      <div class="card"><h2 id="newCerts">--</h2><p>New Certified Teachers</p></div>
      <div class="card"><h2 id="projRetire">--</h2><p>Projected Retirements</p></div>
    </div>

    <!-- Charts -->
    <div class="charts-grid">
      <div class="chart"><h3>Supply vs Demand by Specialty</h3><canvas id="supplyDemandChart"></canvas></div>
      <div class="chart"><h3>Institution Output (Top 10)</h3><canvas id="institutionChart"></canvas></div>
      <div class="chart"><h3>Retirement Projection</h3><canvas id="retireChart"></canvas></div>
    </div>

    <!-- County Map -->
    <div class="map-container">
      <h3>Vacancies by County</h3>
      <p class="note">(Requires HTTP server to load SVG via relative path)</p>
      <!-- Ensure ky_counties.svg is in same folder or adjust path -->
      <object type="image/svg+xml" data="assets/ky_counties.svg"></object>
    </div>

    <!-- CIP Positions Table -->
    <div class="table-container">
      <h3>CIP Code Positions Reference</h3>
      <p class="note">(Ensure cips_positions.csv is in same folder)</p>
      <table id="positionsTable">
        <thead><tr><th>CIP Code</th><th>Position Title</th></tr></thead>
        <tbody><tr><td colspan="2">Loading...</td></tr></tbody>
      </table>
    </div>
  </div>

  <script>
    // Example KPI values
    document.getElementById('totalOpen').innerText = '4,120';
    document.getElementById('newCerts').innerText = '2,350';
    document.getElementById('projRetire').innerText = '3,800';

    // Supply vs Demand Chart
    const specialties = ['Elementary','Math','ESL','Special Ed','Admin'];
    const openings = [400,350,150,200,100];
    const certs = [300,250,100,120,80];
    new Chart('supplyDemandChart', {
      type: 'bar', data: { labels: specialties, datasets: [{ label: 'Openings', data: openings },{ label: 'New Certs', data: certs }] },
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    // Institution Output Chart
    const institutions = ['Univ A','Univ B','Univ C','Univ D','Univ E','Univ F','Univ G','Univ H','Univ I','Univ J'];
    const grads = [200,180,160,140,120,100,80,60,40,20];
    new Chart('institutionChart', {
      type: 'bar', data: { labels: institutions, datasets: [{ label: 'Graduates', data: grads }] },
      options: { indexAxis: 'y', responsive: true, scales: { x: { beginAtZero: true } } }
    });

    // Retirement Projection Chart
    const years = Array.from({ length: 11 }, (_, i) => i);
    const retire55 = [10,15,20,25,30,35,40,45,50,55,60];
    const retire60 = [5,10,15,20,25,30,35,40,45,50,55];
    new Chart('retireChart', {
      type: 'line', data: { labels: years, datasets: [{ label: 'Age 55-59', data: retire55, fill: false },{ label: 'Age 60-64', data: retire60, fill: false }] },
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    // Load CIP positions CSV
    Papa.parse('data/cips_positions.csv', {
      download: true, header: true,
      complete: results => {
        const tbody = document.querySelector('#positionsTable tbody');
        tbody.innerHTML = '';
        results.data.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${row['CIP Code']}</td><td>${row['Position Title']}</td>`;
          tbody.appendChild(tr);
        });
      }
    });
  </script>
</body>
</html>
